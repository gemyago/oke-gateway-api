---
description: 
globs: *.go
alwaysApply: false
---
# golang project rules, apply in agent mode

## common rules
- Build plan, ALWAYS confirm before proceeding
- TDD must be followed if adding new stuff, which means:
  1. Add stub declarations (for struct function panic not implemented)
  2. Add or extend tests that are testing desired logic
    - after extending, show command to run tests in form (yes using gow): 
      `gow test -v ./<package path> --run <test name>`
  3. Implement the logic
- Use mockery to create mocks for dependencies
  - add mocks to @.mockery.yaml
  - run `mockery` from root to regenerate

## Rules for tests
- define tests in same package
- prefer single top-level function per component and do multiple nested run blocks
- define newMockDeps function in the stop of the func that will initialize dependencies (if applicable)
- when implementing multiple test cases, confirm after each case
- use require.Error or require.ErrorIs when asserting errors
- use faker (github.com/go-faker/faker/v4) to generate random texts